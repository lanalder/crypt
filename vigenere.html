<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <style>
    body {
      background-color: #fff8f6;
    }
    textarea:focus {
  	  outline: 0;
    }
    #ctext {
      appearance: none;
      height: 50vh;
      width: 25vw;
      margin: 10vh 25vw 25vh 10vw;
      box-shadow: inset 0px 1px 0px 0px #8e8e8e;
      background-color: #f7f2f0;
    }
    .cipherB {
      height: 3vh;
      width: 5vw;
      margin: -20vh 35vw 22vh 20vw;
      box-shadow: 0px 1px 1px 0px #8e8e8e;
      background-color: #f7f2f0;
      font-size: 12px;
      text-align: center;
      cursor: pointer;
    }
  </style>
  <title>Document</title>
</head>
<body>
  <textarea type="compact" id="ctext" required minlength="5" maxlength="8000"></textarea>
  <div class="cipherB">cipher</div>
</body>
<script>

  //being lazy the letters will be numbers n accessed via index
  var freqTab = [8.15,1.44,2.76,3.79,13.11,2.92,1.99,5.26,6.35,0.13,0.42,3.39,2.54, 7.10,8.00,1.98,0.12,6.83,6.10,10.47,2.46,0.92,1.54,0.17,1.98,0.08],
      abc = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q', 'r','s','t','u','v','w','x','y','z'],
      kw = new Array(),
      kwL,
      inp = document.querySelector('#ctext'),
      txt = inp.value,
      pos = 0;

  txt = txt.replace(/[^\w\s]|_/g," ").replace(/\s+/g," ").toLowerCase();
  var txtArr = txt.split('');
  // txtArr = txtArr.filter(x => x !== " ");
  // mayb for ease of deciphering at first lets leave in spaces

  const txtL = txtArr.length,
        cb = document.querySelector('.cipherB');

  function genKey() {
    kwL = Math.abs(Math.floor(Math.random()*(5-txtL/5)+5));
    for (let i = 0; i < kwL; i++) {
      let ranlet = Math.abs(Math.floor(Math.random()*(0-25)));
      kw[i] = abc[ranlet];
    }
    cipher();
  }

  console.log(txt);

  function cipher() {
    for (var i = pos; i < kwL+pos; i++) {
      let keyInd = abc.findIndex(x => x == kw[i%kwL]);
      let txtInd = abc.findIndex(x => x == txtArr[i]);
      let newLet = ((26-txtInd)+keyInd)%26;
      txtArr[i] = abc[newLet];
    }
    pos = pos+kwL;
    while (pos<txtArr.length) {
      cipher();
    }
    txt = txtArr.join('')
    inp.value = txt;
    console.log(kw, txt, pos, txtArr.length);
  }

  cb.addEventListener('click', function() {
    //what happens when multiple clicks / ciphers? seems like its only ciphering the keyword lol N THEN on reclick cipheres the ciphere d txt w new;y gend keyw
    genKey();
  })

</script>
</html>
