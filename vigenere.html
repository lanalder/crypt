<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <style>
    body {
      background-color: #fff8f6;
    }
    textarea:focus {
  	  outline: 0;
    }
    .big-contain {
      display: flex;
      flex-direction: row;
      align-items: space-between;
    }
    .c-container,
    .dc-container {
      display: flex;
      margin-top: 10vh;
      flex-direction: column;
      justify-content: center;
      flex-grow: 1;
    }
    .ctext,
    .dctext {
      appearance: none;
      height: 25vh;
      box-shadow: inset 0px 1px 0px 0px #8e8e8e;
      background-color: #f7f2f0;
      margin: 2vh 2vw 2vh 2vw;
    }
    .cipherB,
    .dcipherB {
      box-shadow: 0px 1px 1px 0px #8e8e8e;
      background-color: #f7f2f0;
      margin-top: 2vh;
      align-self: center;
      width: 20%;
      font-size: 0.8rem;
      text-align: center;
      cursor: pointer;
    }
  </style>
  <title>Document</title>
</head>
<body>
  <div class="big-contain">
    <div class="c-container">
      <textarea type="compact" class="ctext" required minlength="5" maxlength="8000"></textarea>
      <div class="cipherB">get cipherd</div>
    </div>
    <div class="dc-container">
      <textarea type="compact" class="dctext" required minlength="5" maxlength="8000"></textarea>
      <div class="dcipherB">de-nonsensify</div>
    </div>
  </div>
</body>
<script>

  const abc = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q', 'r','s','t','u','v','w','x','y','z'],
      freqTab = [8.15,1.44,2.76,3.79,13.11,2.92,1.99,5.26,6.35,0.13,0.42,3.39,2.54, 7.10,8.00,1.98,0.12,6.83,6.10,10.47,2.46,0.92,1.54,0.17,1.98,0.08],
      cii = document.querySelector('.ctext'),
      dci = document.querySelector('.dctext'),
      cb = document.querySelector('.cipherB'),
      dcb = document.querySelector('.dcipherB');

  var kw = [],
      kwL,
      c = {og: null, min: null, ci: null},
      dc = Object.create(c),
      ca = [],
      dca = [],
      rp = [],
      pos = 0,
      ccl = 0;

  function init(a, b, c) {
    arguments[0].og = arguments[1].value;
    arguments[0].min = arguments[0].og.replace(/[^\w\s]|_/g," ").replace(/\s+/g," ").toLowerCase();
    arguments[2] = arguments[0].min.split('');
    arguments[2] = arguments[2].filter(x => x !== " ");
    console.log(arguments[2]);
  }

  function genKey() {
    console.log(ca);
    kwL = Math.abs(Math.round(Math.random()*(5-ca.length/10)+5));
    for (let i = 0; i < kwL; i++) {
      let ranlet = Math.abs(Math.round(Math.random()*(0-25)));
      kw[i] = abc[ranlet];
    }
    cipher();
  }

  function cipher() {
    for (let i = pos; i < kwL+pos; i++) {
      let keyInd = abc.findIndex(x => x == kw[i%kwL]);
      let cInd = abc.findIndex(x => x == ca[i]);
      let newLet = ((26-cInd)+keyInd)%26;
      ca[i] = abc[newLet];
    }
    pos += kwL;
    while (pos<ca.length) {
      cipher();
    }
    c.ci = ca.join('');
  }

  cb.addEventListener('click', function() {
    if (ccl%2) {
      cb.textContent = 'get cipherd';
      cii.value = c.og;
    } else {
      pos = 0;
      init(c, cii, ca);
      genKey();
      cii.value = c.ci;
      cb.textContent = 'show og';
    }
    ccl++;
  });

  // for (let i=0; i<dcL/3; i++) {
  //   looksee[i] = new Array(3);
  // }
  //
  // function fact() {
  //   for (let i=0; i<dcL-3; i+3) {
  //     looksee
  //   }
  // }


</script>
</html>
